module.exports=[91119,a=>{"use strict";var b=a.i(87924),c=a.i(68114);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>g,"CardHeader",()=>e,"CardTitle",()=>f])},29246,a=>{"use strict";var b=a.i(87924),c=a.i(68114);function d({className:a,...d}){return(0,b.jsx)("textarea",{"data-slot":"textarea",className:(0,c.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...d})}a.s(["Textarea",()=>d])},49254,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(58712);a.i(30485);var f=a.i(31052),g=a.i(1312),h=a.i(91119),i=a.i(99570),j=a.i(66718),k=a.i(29246),l=a.i(86304),m=a.i(68114),n=a.i(38246);function o(){let a=(0,g.useT)(),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)({});(0,c.useEffect)(()=>{if(!e.isMockMode){let a=(0,f.onAuthStateChanged)(e.auth,a=>{a&&p(!0)});return()=>a()}},[]),(0,c.useEffect)(()=>{if(e.isMockMode)return void r([{id:"req-1",orderId:"ORD-1024",technicianId:"tech-1",technicianName:"Ahmed",partOrServiceName:"iPhone Screen Replacement",category:"spare_part",quantity:1,estimatedPrice:350,reason:"Original screen cracked during diagnosis",photoUrl:"",status:"pending",createdAt:new Date().toISOString()},{id:"req-2",orderId:"ORD-1025",technicianId:"tech-2",technicianName:"Sara",partOrServiceName:"Data Backup Service",category:"additional_service",quantity:1,estimatedPrice:120,reason:"Customer requested full backup before repair",photoUrl:"",status:"approved",createdAt:new Date().toISOString(),finalPrice:100}]);let a=(0,d.query)((0,d.collection)(e.db,"tech_requests"),(0,d.orderBy)("createdAt","desc")),b=(0,d.onSnapshot)(a,a=>{r(a.docs.map(a=>({id:a.id,...a.data()})))});return()=>b()},[]);let y=async a=>{if(e.isMockMode)return;let b=(0,d.doc)(e.db,"orders",a.orderId),c=(a.finalPrice??a.estimatedPrice)*a.quantity;await (0,d.updateDoc)(b,{invoiceItems:(0,d.arrayUnion)({description:a.partOrServiceName,category:a.category,quantity:a.quantity,unitPrice:a.finalPrice??a.estimatedPrice,total:c,requestId:a.id,addedAt:d.Timestamp.now()}),totalCost:a.totalCost?a.totalCost+c:void 0,pendingRequestsCount:a.pendingRequestsCount?a.pendingRequestsCount-1:void 0,updatedAt:d.Timestamp.now(),status:"in_progress"})},z=async(a,b,c)=>{e.isMockMode||await (0,d.addDoc)((0,d.collection)(e.db,"notifications"),{role:a,userId:"technician"===a?c.technicianId:void 0,type:"tech_request",message:b,orderId:c.orderId,requestId:c.id,createdAt:d.Timestamp.now()})},A=async b=>{if(e.isMockMode)return void r(a=>a.map(a=>a.id===b.id?{...a,status:"approved",updatedAt:new Date().toISOString(),adminNotes:w[b.id]||a.adminNotes}:a));let c=(0,d.doc)(e.db,"tech_requests",b.id);await (0,d.updateDoc)(c,{status:"approved",updatedAt:d.Timestamp.now(),adminNotes:w[b.id]||null,history:(0,d.arrayUnion)({action:"approved",by:"admin",at:d.Timestamp.now(),note:w[b.id]||null})}),await y(b),await z("technician",a("Request approved"),b)},B=async b=>{if(e.isMockMode)return void r(a=>a.map(a=>a.id===b.id?{...a,status:"rejected",updatedAt:new Date().toISOString(),adminNotes:w[b.id]||a.adminNotes}:a));let c=(0,d.doc)(e.db,"tech_requests",b.id);await (0,d.updateDoc)(c,{status:"rejected",updatedAt:d.Timestamp.now(),adminNotes:w[b.id]||null,history:(0,d.arrayUnion)({action:"rejected",by:"admin",at:d.Timestamp.now(),note:w[b.id]||null})}),await z("technician",a("Request rejected"),b)},C=async b=>{let c=parseFloat(u);if(isNaN(c)||c<0)return;if(e.isMockMode){r(a=>a.map(a=>a.id===b.id?{...a,finalPrice:c,updatedAt:new Date().toISOString(),priceChanges:[...a.priceChanges||[],{oldPrice:a.estimatedPrice,newPrice:c,changedAt:new Date().toISOString(),changedBy:"admin"}]}:a)),t(null),v("");return}let f=(0,d.doc)(e.db,"tech_requests",b.id);await (0,d.updateDoc)(f,{finalPrice:c,updatedAt:d.Timestamp.now(),priceChanges:(0,d.arrayUnion)({oldPrice:b.estimatedPrice,newPrice:c,changedAt:d.Timestamp.now(),changedBy:"admin"}),history:(0,d.arrayUnion)({action:"price_updated",by:"admin",at:d.Timestamp.now(),note:`AED ${b.estimatedPrice} -> AED ${c}`})}),t(null),v(""),await z("technician",a("Price updated by admin"),b)};return o?(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("h1",{className:"text-2xl font-bold text-white",children:a("Technician Requests")})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[q.map(c=>{let d;return(0,b.jsxs)(h.Card,{className:"bg-white/5 border-white/10",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{className:"text-white flex items-center justify-between",children:[(0,b.jsx)("span",{children:c.partOrServiceName}),(d=c.status,(0,b.jsx)(l.Badge,{variant:"outline",className:(0,m.cn)("capitalize","pending"===d?"text-yellow-400 border-yellow-400/40":"approved"===d?"text-green-400 border-green-400/40":"text-red-400 border-red-400/40"),children:a(d.charAt(0).toUpperCase()+d.slice(1))}))]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-3 text-sm text-white/80",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{children:["#",c.orderId]}),(0,b.jsx)(n.default,{href:"/admin/orders",className:"text-cyan-400 hover:underline",children:a("View Details")})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{children:[a("Quantity"),": ",c.quantity]}),(0,b.jsxs)("span",{children:[a("Estimated Price (AED)"),": ",c.estimatedPrice]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("span",{className:"text-white/50",children:[a("Reason for Request"),":"]}),(0,b.jsx)("p",{className:"mt-1",children:c.reason})]}),c.photoUrl&&(0,b.jsx)("img",{src:c.photoUrl,alt:"photo",className:"w-full h-36 object-cover rounded-lg border border-white/10"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-white/50",children:a("Admin Notes")}),(0,b.jsx)(k.Textarea,{value:w[c.id]||"",onChange:a=>{let b,d;return b=c.id,d=a.target.value,x(a=>({...a,[b]:d}))},className:"bg-black/20 border-white/10 text-white"})]}),(0,b.jsx)("div",{className:"space-y-2",children:s===c.id?(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(j.Input,{type:"number",value:u,onChange:a=>v(a.target.value),className:"bg-black/20 border-white/10 text-white"}),(0,b.jsx)(i.Button,{onClick:()=>C(c),className:"bg-cyan-500 text-black",children:a("Save")}),(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>{t(null),v("")},children:a("Cancel")})]}):(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>{t(c.id),v(String(c.finalPrice??c.estimatedPrice))},children:a("Edit Price")})}),(0,b.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,b.jsx)(i.Button,{onClick:()=>A(c),className:"bg-green-500 text-black",children:a("Approve Request")}),(0,b.jsx)(i.Button,{onClick:()=>B(c),className:"bg-red-500 text-white",children:a("Reject Request")})]})]})]},c.id)}),0===q.length&&(0,b.jsx)(h.Card,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(h.CardContent,{className:"p-6 text-white/60",children:a("No requests")})})]})]}):null}a.s(["default",()=>o])}];

//# sourceMappingURL=src_a3b2fc70._.js.map