(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63116,e=>{"use strict";var t=e.i(43476),s=e.i(71645),i=e.i(75157);function a({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,i.cn)("w-full caption-bottom text-sm",e),...s})})}function r({className:e,...s}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,i.cn)("[&_tr]:border-b",e),...s})}function n({className:e,...s}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,i.cn)("[&_tr:last-child]:border-0",e),...s})}function l({className:e,...s}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,i.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...s})}function d({className:e,...s}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,i.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}function c({className:e,...s}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,i.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}var o=e.i(93479),m=e.i(67489),h=e.i(19455),x=e.i(87486),p=e.i(76639),u=e.i(55436),j=e.i(75254);let g=(0,j.default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);var v=e.i(84614),b=e.i(3116),N=e.i(27612),w=e.i(86536),f=e.i(69638),y=e.i(78894);let D=(0,j.default)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var C=e.i(7233),I=e.i(94983);function S(e,t){var s,i;let a,r,n,l=(s=e,i=t,r=((a=(a=s.replace(/\D/g,"")).replace(/^0+/,"")).startsWith("971")||(a=`971${a}`),a),n=encodeURIComponent(i),`https://wa.me/${r}?text=${n}`);window.open(l,"_blank","noopener,noreferrer")}let P=(e,t,s)=>`Ø£Ø®Ø¨Ø§Ø± Ø³Ø§Ø±Ø©! ðŸŽ‰

ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ†ÙŠ *${t}* Ù„Ø·Ù„Ø¨Ùƒ #${e}

ðŸ“ž Ù„Ù„ØªÙˆØ§ØµÙ„: ${s}

Ø³ÙŠØµÙ„ Ø¥Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹!`,k=(e,t)=>`âœ… ØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­!

Ø·Ù„Ø¨: #${e}

â­ Ù‚ÙŠÙ‘Ù… ØªØ¬Ø±Ø¨ØªÙƒ: ${t}

Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±Ùƒ KBI Repair!`;var A=e.i(90489),T=e.i(55146);e.i(36180);var M=e.i(98925),B=e.i(11605);e.i(51718);var z=e.i(18357),O=e.i(94913),_=e.i(83814);function E(e){let i=(0,_.useT)(),{order:a,items:r,invoiceNumber:n,invoiceDate:l,language:d,discount:c=0,vatEnabled:o=!1,vatRate:m=0,warrantyPeriod:h="3 months",adminNotes:x="",disclaimerText:p=i("Payment due upon completion of repair.")}=e,u=(0,s.useMemo)(()=>{let e=r.reduce((e,t)=>e+Number(t.total||t.unitPrice*t.quantity),0),t=e-Number(c||0),s=o?t*Number(m||0):0;return{subtotal:e,vatAmount:s,finalTotal:t+s}},[r,c,o,m]),j=(0,s.useMemo)(()=>{let e=`KBI Invoice ${n} | Order ${a?.orderId||a?.id}`;return`https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(e)}`},[n,a]),g=()=>(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xl font-bold",children:"KBI"}),(0,t.jsx)("p",{className:"text-sm",children:i("On-Site Repair Service")}),(0,t.jsx)("p",{className:"text-sm",children:"Abu Dhabi â€“ UAE"}),(0,t.jsx)("p",{className:"text-sm",children:"+971 50 731 3446"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"font-semibold",children:[i("Invoice Number"),": ",n]}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Order ID"),": ",a?.orderId||a?.id]}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Invoice Date"),": ","string"==typeof l?l:new Date(l).toLocaleDateString()]})]})]}),v=()=>(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Customer Information")}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Customer Name"),": ",a?.customerName]}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Phone Number"),": ",a?.customerPhone]}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Service Address"),": ",a?.location||a?.address||""]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Device Information")}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Device Type"),": ",a?.deviceType||a?.device]}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Brand"),": ",a?.brand]}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Model"),": ",a?.model]}),(0,t.jsxs)("p",{className:"text-sm",children:[i("Serial Number (optional)"),": ",a?.serial||""]})]})]}),b=()=>(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-2 border-b py-2 text-xs font-semibold",children:[(0,t.jsx)("div",{className:"col-span-5",children:i("Description")}),(0,t.jsx)("div",{className:"col-span-2",children:i("Type")}),(0,t.jsx)("div",{className:"col-span-1 text-right",children:i("Qty")}),(0,t.jsx)("div",{className:"col-span-2 text-right",children:i("Unit Price (AED)")}),(0,t.jsx)("div",{className:"col-span-2 text-right",children:i("Total (AED)")})]}),r.map((e,s)=>(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-2 border-b py-2 text-sm",children:[(0,t.jsx)("div",{className:"col-span-5",children:e.description}),(0,t.jsx)("div",{className:"col-span-2",children:e.category||""}),(0,t.jsx)("div",{className:"col-span-1 text-right",children:e.quantity}),(0,t.jsx)("div",{className:"col-span-2 text-right",children:Number(e.unitPrice).toFixed(2)}),(0,t.jsx)("div",{className:"col-span-2 text-right",children:Number(e.total||e.unitPrice*e.quantity).toFixed(2)})]},s))]}),N=()=>(0,t.jsx)("div",{className:"mt-4 w-full flex justify-end",children:(0,t.jsxs)("div",{className:"w-64 space-y-1 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:i("Subtotal")}),(0,t.jsx)("span",{children:u.subtotal.toFixed(2)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:i("Discount")}),(0,t.jsx)("span",{children:Number(c||0).toFixed(2)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:i("VAT")}),(0,t.jsx)("span",{children:u.vatAmount.toFixed(2)})]}),(0,t.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,t.jsx)("span",{children:i("Final Total Price (AED)")}),(0,t.jsx)("span",{children:u.finalTotal.toFixed(2)})]})]})}),w=()=>(0,t.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold mb-1",children:i("Warranty & Notes")}),(0,t.jsxs)("p",{children:[i("Warranty Period"),": ",h]}),x?(0,t.jsxs)("p",{className:"mt-2",children:[i("Admin Notes"),": ",x]}):null]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("img",{src:j,alt:"QR",className:"inline-block"})})]}),f=()=>(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t text-sm",children:[(0,t.jsx)("p",{children:p}),(0,t.jsx)("p",{className:"mt-1",children:i("Thank you for choosing KBI.")})]}),y=()=>(0,t.jsxs)("div",{className:"bg-white text-black p-6 rounded shadow-sm",children:[(0,t.jsx)(g,{}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(v,{})}),(0,t.jsx)(b,{}),(0,t.jsx)(N,{}),(0,t.jsx)(w,{}),(0,t.jsx)(f,{}),(0,t.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Customer Signature")}),(0,t.jsx)("div",{className:"h-16 border rounded"})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Technician Signature")}),(0,t.jsx)("div",{className:"h-16 border rounded"})]})]})]});return"both"===d?(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)(y,{}),(0,t.jsxs)("div",{dir:"rtl",className:"bg-white text-black p-6 rounded shadow-sm",children:[(0,t.jsx)(g,{}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(v,{})}),(0,t.jsx)(b,{}),(0,t.jsx)(N,{}),(0,t.jsx)(w,{}),(0,t.jsx)(f,{}),(0,t.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Customer Signature")}),(0,t.jsx)("div",{className:"h-16 border rounded"})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Technician Signature")}),(0,t.jsx)("div",{className:"h-16 border rounded"})]})]})]})]}):"ar"===d?(0,t.jsxs)("div",{dir:"rtl",className:"bg-white text-black p-6 rounded shadow-sm",children:[(0,t.jsx)(g,{}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(v,{})}),(0,t.jsx)(b,{}),(0,t.jsx)(N,{}),(0,t.jsx)(w,{}),(0,t.jsx)(f,{}),(0,t.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Customer Signature")}),(0,t.jsx)("div",{className:"h-16 border rounded"})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:i("Technician Signature")}),(0,t.jsx)("div",{className:"h-16 border rounded"})]})]})]}):(0,t.jsx)(y,{})}var $=e.i(74911),R=e.i(25324),F=e.i(75059);let U={pending:"bg-yellow-500/20 text-yellow-500 border-yellow-500/50",in_progress:"bg-blue-500/20 text-blue-500 border-blue-500/50",waiting_parts:"bg-orange-500/20 text-orange-500 border-orange-500/50",completed:"bg-green-500/20 text-green-500 border-green-500/50",delivered:"bg-purple-500/20 text-purple-500 border-purple-500/50",cancelled:"bg-red-500/20 text-red-500 border-red-500/50"};function L(){let e,j,L,H,q,W=(0,_.useT)(),[K,V]=(0,s.useState)(!1),[J,Q]=(0,s.useState)([]),[G,Y]=(0,s.useState)([]),[Z,X]=(0,s.useState)(""),[ee,et]=(0,s.useState)("all"),[es,ei]=(0,s.useState)(!0),[ea,er]=(0,s.useState)(null),[en,el]=(0,s.useState)(!1),[ed,ec]=(0,s.useState)(""),[eo,em]=(0,s.useState)(!1),[eh,ex]=(0,s.useState)(""),[ep,eu]=(0,s.useState)("en"),[ej,eg]=(0,s.useState)("0"),[ev,eb]=(0,s.useState)(!1),[eN,ew]=(0,s.useState)("0"),[ef,ey]=(0,s.useState)("3 months"),[eD,eC]=(0,s.useState)(""),[eI,eS]=(0,s.useState)("Payment due upon completion of repair."),[eP,ek]=(0,s.useState)(!1),[eA,eT]=(0,s.useState)(""),[eM,eB]=(0,s.useState)(null),[ez,eO]=(0,s.useState)(!1),[e_,eE]=(0,s.useState)(""),[e$,eR]=(0,s.useState)(""),[eF,eU]=(0,s.useState)(""),[eL,eH]=(0,s.useState)(""),[eq]=(0,s.useState)(10),[eW,eK]=(0,s.useState)(1);(0,s.useEffect)(()=>{let e=(0,z.onAuthStateChanged)(B.auth,e=>{e?(V(!0),(0,F.getUserRole)(e.uid).then(eB)):window.location.replace("/admin/login")});if(B.isMockMode)return Q([]),Y([]),ei(!1),()=>{e()};let t=(0,M.query)((0,M.collection)(B.db,"orders"),(0,M.orderBy)("createdAt","desc")),s=(0,M.onSnapshot)(t,e=>{Q(e.docs.map(e=>{let t=e.data();return{id:e.id,orderId:t.orderId||e.id,customerName:t.customerName||t.name||"Unknown",customerPhone:t.customerPhone||t.phone||"",deviceType:t.deviceType||"Device",brand:t.brand||"",model:t.model||"",issue:t.issue||t.issueType||"",status:eV(t.status),technicianId:t.technicianId,technicianName:t.technicianName||t.technician,createdAt:t.createdAt,estimatedCompletion:t.estimatedCompletion,price:t.price,notes:t.notes,statusHistory:t.statusHistory}})),ei(!1)},e=>{(0,$.toast)({title:W("Failed to load orders"),description:e?.message||W("Please try again")}),ei(!1)}),i=(0,M.onSnapshot)((0,M.collection)(B.db,"technicians"),e=>{Y(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{(0,$.toast)({title:W("Failed to load technicians"),description:e?.message||W("Please try again")})});return()=>{e(),s(),i()}},[]);let eV=e=>{if(!e)return"pending";let t=e.toLowerCase().replace(/\s+/g,"_");return"order_created"===t||"pending"===t?"pending":"in_progress"===t?"in_progress":"waiting_parts"===t?"waiting_parts":"completed"===t?"completed":"delivered"===t?"delivered":"cancelled"===t?"cancelled":"pending"},eJ=e=>{let t=[],s=Number(e.price||0);return s>0&&t.push({description:e.issue||"Repair Service",category:"service",quantity:1,unitPrice:s,total:s}),[...t,...e.invoiceItems||[]]},eQ=async()=>{let e=(0,M.doc)(B.db,"counters","invoices");return await (0,M.runTransaction)(B.db,async t=>{let s=await t.get(e),i=s.exists()?Number(s.data().current||0):0;return i+=1,t.set(e,{current:i},{merge:!0}),`INV-${String(i).padStart(6,"0")}`})},eG=async()=>{ea&&(eh||ex(await eQ()),em(!0))},eY=async()=>{if(!ea)return;let e=Number(ej||0),t=Number(eN||0),s=eJ(ea).reduce((e,t)=>e+Number(t.total||t.unitPrice*t.quantity),0),i=s-e,a=ev?i*t:0,r=(0,M.doc)(B.db,"orders",ea.id);await (0,M.updateDoc)(r,{invoice:{invoiceNumber:eh,invoiceDate:M.Timestamp.now(),status:"finalized",generatedBy:"admin",discount:e,vatRate:t,vatEnabled:ev,warrantyPeriod:ef,adminNotes:eD,disclaimerText:eI,subtotal:s,total:i+a,language:ep,history:(0,M.arrayUnion)({action:"finalized",by:"admin",at:M.Timestamp.now()})},updatedAt:M.Timestamp.now()}),ek(!0)},eZ=async()=>{if(!ea||!eA)return;let e=(0,M.doc)(B.db,"orders",ea.id);await (0,M.updateDoc)(e,{invoice:{...ea.invoice,history:(0,M.arrayUnion)({action:"override",by:"admin",at:M.Timestamp.now(),note:eA})},updatedAt:M.Timestamp.now()}),eT("")};if(!K)return null;let eX=J.filter(e=>{let t=e.customerName.toLowerCase().includes(Z.toLowerCase())||e.orderId.toLowerCase().includes(Z.toLowerCase())||e.customerPhone.includes(Z),s="all"===ee||e.status===ee;return t&&s}),e0=async(e,t)=>{let s=J.find(t=>t.id===e),i={status:t,timestamp:M.Timestamp.now(),note:`${W("Status updated to")} ${"in_progress"===t?W("In Progress"):"waiting_parts"===t?W("Waiting Parts"):"completed"===t?W("Completed"):"delivered"===t?W("Delivered"):"cancelled"===t?W("Cancelled"):W("Pending")}`};try{await (0,M.updateDoc)((0,M.doc)(B.db,"orders",e),{status:t,statusHistory:(0,M.arrayUnion)(i)}),(0,$.toast)({title:W("Status updated"),description:`${W("Order")} ${s?.orderId} ${W("now")} ${e8(t)}`})}catch(e){(0,$.toast)({title:W("Failed to update status"),description:e?.message||W("Please try again")});return}if(s?.customerPhone){let e="";switch(t){case"in_progress":e=P(s.orderId,s.technicianName||"Technician","");break;case"completed":e=k(s.orderId,`kbi.ae/rate?orderId=${s.orderId}`)}e&&(S(s.customerPhone,e),(0,$.toast)({title:W("WhatsApp opened"),description:W("Customer notified")}))}let a=B.auth.currentUser;a&&(0,A.logAction)(A.AuditActions.ORDER_UPDATED,"order",a.uid,a.email||"",{targetId:e,targetType:"order",details:{newStatus:t}})},e1=async(e,t)=>{let s=G.find(e=>e.id===t);if(!s)return;let i=J.find(t=>t.id===e),a={status:"in_progress",timestamp:M.Timestamp.now(),note:`${W("Assigned to technician")} ${s.name}`};try{await (0,M.updateDoc)((0,M.doc)(B.db,"orders",e),{technicianId:t,technicianName:s.name,status:"in_progress",statusHistory:(0,M.arrayUnion)(a)}),(0,$.toast)({title:W("Technician assigned"),description:`${s.name} â€¢ ${W("Order")} ${i?.orderId}`})}catch(e){(0,$.toast)({title:W("Failed to assign"),description:e?.message||W("Please try again")});return}if(i?.customerPhone){let e=P(i.orderId,s.name,"");S(i.customerPhone,e),(0,$.toast)({title:W("WhatsApp opened"),description:W("Customer notified")})}let r=B.auth.currentUser;r&&(0,A.logAction)(A.AuditActions.ORDER_UPDATED,"order",r.uid,r.email||"",{targetId:e,targetType:"order",details:{assignedTo:s.name}})},e2=async e=>{if(confirm(W("Are you sure you want to delete this order?")))try{await (0,M.deleteDoc)((0,M.doc)(B.db,"orders",e)),(0,$.toast)({title:W("Order deleted"),description:e});let t=B.auth.currentUser;t&&(0,A.logAction)(A.AuditActions.ORDER_DELETED,"order",t.uid,t.email||"",{targetId:e,targetType:"order"})}catch(e){(0,$.toast)({title:W("Delete failed"),description:e?.message||W("Please try again")})}},e5=(e,t)=>{if(!e.customerPhone)return void(0,$.toast)({title:W("No phone number available"),description:W("Add customer phone to order")});let s="";switch(t){case"confirmation":let i,a;i=e.orderId,a=e.customerName,s=`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${a}! ðŸ‘‹

ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø±Ù‚Ù… #${i} Ø¨Ù†Ø¬Ø§Ø­ âœ…

Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† ÙÙ†ÙŠ Ù„Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.

Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©: kbi.ae/track

KBI Repair Services`;break;case"assigned":s=P(e.orderId,e.technicianName||"Technician","");break;case"complete":s=k(e.orderId,`kbi.ae/rate?orderId=${e.orderId}`);break;default:s=`Order #${e.orderId} update`}S(e.customerPhone,s),(0,$.toast)({title:W("WhatsApp opened"),description:W("Customer notified")})},e4=async()=>{if(!ea||!ed)return;let e=parseInt(ed,10);if(isNaN(e)||e<0)return;let t=new Date(Date.now()+6e4*e).toISOString();await (0,M.updateDoc)((0,M.doc)(B.db,"orders",ea.id),{estimatedCompletion:t,updatedAt:M.Timestamp.now()}),ec("")},e6=Math.ceil(eX.length/eq),e3=eX.slice((eW-1)*eq,eW*eq),e8=e=>"in_progress"===e?W("In Progress"):"waiting_parts"===e?W("Waiting Parts"):"completed"===e?W("Completed"):"delivered"===e?W("Delivered"):"cancelled"===e?W("Cancelled"):W("Pending"),e7=async e=>{try{if(B.isMockMode){Q(t=>t.map(t=>t.id===e.id?{...t,...t,approvedPrice:t.proposedPrice??null,approvedDurationMinutes:t.proposedDurationMinutes??null,approvedByAdminId:"mock_admin",approvedAt:new Date().toISOString(),pricingStatus:"approved"}:t)),(0,$.toast)({title:W("Proposal approved"),description:e.orderId});return}let t=B.auth.currentUser?.uid||"";await (0,R.approveOrderPricing)(e.id,t),(0,$.toast)({title:W("Proposal approved"),description:e.orderId})}catch(e){(0,$.toast)({title:W("Failed to approve"),description:e?.message||W("Please try again")})}},e9=async e=>{try{if(B.isMockMode){Q(t=>t.map(t=>t.id===e.id?{...t,...t,pricingStatus:"rejected"}:t)),(0,$.toast)({title:W("Proposal rejected"),description:e.orderId});return}await (0,R.rejectOrderPricing)(e.id),(0,$.toast)({title:W("Proposal rejected"),description:e.orderId})}catch(e){(0,$.toast)({title:W("Failed to reject"),description:e?.message||W("Please try again")})}},te=async e=>{try{if("super_admin"!==eM)return void(0,$.toast)({title:W("Not allowed"),description:W("Only Super Admin can counter")});if(B.isMockMode){Q(t=>t.map(t=>t.id===e.id?{...t,...t,counterPrice:parseFloat(e_||"0")||null,counterDurationMinutes:parseFloat(e$||"0")||null,counterArrivalETA:eF||null,pricingStatus:"countered"}:t)),eO(!1),eE(""),eR(""),eU(""),eH(""),(0,$.toast)({title:W("Counter saved"),description:e.orderId});return}let t=B.auth.currentUser?.uid||"";await (0,R.counterOfferPricing)(e.id,t,{counterPrice:parseFloat(e_||"0")||null,counterDurationMinutes:parseFloat(e$||"0")||null,counterArrivalETA:eF||null,counterNote:eL}),eO(!1),eE(""),eR(""),eU(""),eH(""),(0,$.toast)({title:W("Counter saved"),description:e.orderId})}catch(e){(0,$.toast)({title:W("Failed to counter"),description:e?.message||W("Please try again")})}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-white",children:W("Orders Management")}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(h.Button,{variant:"outline",onClick:()=>{let e=[W("Order ID"),W("Customer"),W("Phone"),W("Device"),W("Issue"),W("Status"),W("Technician"),W("Created"),W("Price")],t=eX.map(e=>[e.orderId,e.customerName,e.customerPhone,`"${e.brand} ${e.model}"`,`"${e.issue}"`,e.status,e.technicianName||W("Unassigned"),e.createdAt?.seconds?new Date(1e3*e.createdAt.seconds).toISOString():"",e.price||""]),s=encodeURI("data:text/csv;charset=utf-8,"+e.join(",")+"\n"+t.map(e=>e.join(",")).join("\n")),i=document.createElement("a");i.setAttribute("href",s),i.setAttribute("download",`orders_export_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},children:[(0,t.jsx)(D,{className:"mr-2 h-4 w-4"})," ",W("Export CSV")]}),(0,t.jsxs)(h.Button,{children:[(0,t.jsx)(C.Plus,{className:"mr-2 h-4 w-4"})," ",W("New Order")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,t.jsx)(u.Search,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-white/50"}),(0,t.jsx)(o.Input,{placeholder:W("Search orders..."),className:"pl-9 bg-white/5 border-white/10 text-white",value:Z,onChange:e=>X(e.target.value)})]}),(0,t.jsxs)(m.Select,{value:ee,onValueChange:et,children:[(0,t.jsx)(m.SelectTrigger,{className:"w-[180px] bg-white/5 border-white/10 text-white hover:bg-white/10 focus-visible:border-cyan-500 focus-visible:ring-cyan-500/30 outline-none rounded-lg",children:(0,t.jsx)(m.SelectValue,{placeholder:W("Filter by status")})}),(0,t.jsxs)(m.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,t.jsx)(m.SelectItem,{value:"all",children:W("All")}),(0,t.jsx)(m.SelectItem,{value:"pending",children:W("Pending")}),(0,t.jsx)(m.SelectItem,{value:"in_progress",children:W("In Progress")}),(0,t.jsx)(m.SelectItem,{value:"waiting_parts",children:W("Waiting Parts")}),(0,t.jsx)(m.SelectItem,{value:"completed",children:W("Completed")}),(0,t.jsx)(m.SelectItem,{value:"delivered",children:W("Delivered")}),(0,t.jsx)(m.SelectItem,{value:"cancelled",children:W("Cancelled")})]})]})]}),(0,t.jsx)("div",{className:"rounded-md border border-white/10 bg-white/5 overflow-hidden",children:(0,t.jsxs)(a,{children:[(0,t.jsx)(r,{className:"bg-white/5",children:(0,t.jsxs)(l,{className:"border-white/10 hover:bg-white/5",children:[(0,t.jsx)(d,{className:"text-white",children:W("Order ID")}),(0,t.jsx)(d,{className:"text-white",children:W("Customer")}),(0,t.jsx)(d,{className:"text-white",children:W("Device")}),(0,t.jsx)(d,{className:"text-white",children:W("Issue")}),(0,t.jsx)(d,{className:"text-white",children:W("Status")}),(0,t.jsx)(d,{className:"text-white",children:W("Technician")}),(0,t.jsx)(d,{className:"text-white",children:W("Created")}),(0,t.jsx)(d,{className:"text-white text-right",children:W("Actions")})]})}),(0,t.jsx)(n,{children:0===eX.length?(0,t.jsx)(l,{children:(0,t.jsx)(c,{colSpan:8,className:"text-center py-8 text-white/50",children:W("No orders found")})}):e3.map(e=>(0,t.jsxs)(l,{className:"border-white/10 hover:bg-white/5",children:[(0,t.jsx)(c,{className:"font-medium text-white",children:e.orderId}),(0,t.jsx)(c,{children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-white",children:e.customerName}),(0,t.jsx)("span",{className:"text-xs text-white/50",children:e.customerPhone})]})}),(0,t.jsxs)(c,{className:"text-white",children:[e.brand," ",e.model]}),(0,t.jsx)(c,{className:"text-white",children:e.issue}),(0,t.jsx)(c,{children:(0,t.jsx)(x.Badge,{variant:"outline",className:(0,i.cn)("capitalize",U[e.status]),children:e8(e.status)})}),(0,t.jsx)(c,{className:"text-white",children:e.technicianName?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.User,{className:"h-3 w-3 text-cyan-400"}),(0,t.jsx)("span",{children:e.technicianName})]}):(0,t.jsx)("span",{className:"text-white/30 italic",children:W("Unassigned")})}),(0,t.jsx)(c,{className:"text-white/60",children:e.createdAt?.seconds?(0,O.formatDistanceToNow)(new Date(1e3*e.createdAt.seconds),{addSuffix:!0}):W("Just now")}),(0,t.jsx)(c,{className:"text-right",children:(0,t.jsxs)(T.DropdownMenu,{children:[(0,t.jsx)(T.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"ghost",className:"h-8 w-8 p-0 text-white/70 hover:text-white",children:[(0,t.jsx)("span",{className:"sr-only",children:W("Open menu")}),(0,t.jsx)(g,{className:"h-4 w-4"})]})}),(0,t.jsxs)(T.DropdownMenuContent,{align:"end",className:"bg-zinc-900 border-zinc-800 text-white",children:[(0,t.jsx)(T.DropdownMenuLabel,{children:W("Actions")}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>{er(e),el(!0)},children:[(0,t.jsx)(w.Eye,{className:"mr-2 h-4 w-4"})," ",W("View Details")]}),(0,t.jsx)(T.DropdownMenuSeparator,{className:"bg-zinc-800"}),(0,t.jsx)(T.DropdownMenuLabel,{children:W("Update Status")}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e0(e.id,"in_progress"),children:[(0,t.jsx)(b.Clock,{className:"mr-2 h-4 w-4"})," ",W("In Progress")]}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e0(e.id,"completed"),children:[(0,t.jsx)(f.CheckCircle,{className:"mr-2 h-4 w-4"})," ",W("Completed")]}),"proposed"===e.pricingStatus&&"super_admin"===eM&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.DropdownMenuSeparator,{className:"bg-zinc-800"}),(0,t.jsx)(T.DropdownMenuLabel,{children:W("Pricing Proposal")}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e7(e),children:[(0,t.jsx)(f.CheckCircle,{className:"mr-2 h-4 w-4"})," ",W("Approve Proposal")]}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e9(e),children:[(0,t.jsx)(y.AlertTriangle,{className:"mr-2 h-4 w-4"})," ",W("Reject Proposal")]}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>{er(e),eO(!0)},children:[(0,t.jsx)(y.AlertTriangle,{className:"mr-2 h-4 w-4"})," ",W("Counter Offer")]})]}),(0,t.jsx)(T.DropdownMenuSeparator,{className:"bg-zinc-800"}),(0,t.jsx)(T.DropdownMenuLabel,{children:W("Assign Technician")}),G.map(s=>(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e1(e.id,s.id),children:[(0,t.jsx)(v.User,{className:"mr-2 h-4 w-4"})," ",s.name]},s.id)),(0,t.jsx)(T.DropdownMenuSeparator,{className:"bg-zinc-800"}),(0,t.jsx)(T.DropdownMenuLabel,{children:W("Notify Customer")}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e5(e,"confirmation"),children:[(0,t.jsx)(I.MessageCircle,{className:"mr-2 h-4 w-4"})," ",W("Order Received")]}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e5(e,"assigned"),children:[(0,t.jsx)(I.MessageCircle,{className:"mr-2 h-4 w-4"})," ",W("Technician Assigned")]}),(0,t.jsxs)(T.DropdownMenuItem,{onClick:()=>e5(e,"complete"),children:[(0,t.jsx)(I.MessageCircle,{className:"mr-2 h-4 w-4"})," ",W("Repair Complete")]}),(0,t.jsx)(T.DropdownMenuSeparator,{className:"bg-zinc-800"}),(0,t.jsxs)(T.DropdownMenuItem,{className:"text-red-500 hover:text-red-400",onClick:()=>e2(e.id),children:[(0,t.jsx)(N.Trash2,{className:"mr-2 h-4 w-4"})," ",W("Delete Order")]})]})]})})]},e.id))})]})}),e6>1&&(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>eK(e=>Math.max(1,e-1)),disabled:1===eW,className:"bg-white/5 border-white/10 hover:bg-white/10 text-white",children:W("Previous")}),(0,t.jsxs)("span",{className:"text-sm text-white/50",children:[W("Page")," ",eW," ",W("of")," ",e6]}),(0,t.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>eK(e=>Math.min(e6,e+1)),disabled:eW===e6,className:"bg-white/5 border-white/10 hover:bg-white/10 text-white",children:W("Next")})]}),(0,t.jsx)(p.Dialog,{open:en,onOpenChange:el,children:(0,t.jsxs)(p.DialogContent,{className:"bg-zinc-950 border-zinc-800 text-white sm:max-w-[600px]",children:[(0,t.jsx)(p.DialogHeader,{children:(0,t.jsxs)(p.DialogTitle,{children:[W("Order Details"),": ",ea?.orderId]})}),ea&&(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Customer")}),(0,t.jsx)("p",{className:"font-semibold",children:ea.customerName}),(0,t.jsx)("p",{className:"text-sm text-white/70",children:ea.customerPhone})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Device")}),(0,t.jsxs)("p",{className:"font-semibold",children:[ea.brand," ",ea.model]}),(0,t.jsx)("p",{className:"text-sm text-white/70",children:ea.deviceType})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Issue")}),(0,t.jsx)("p",{className:"font-semibold",children:ea.issue})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Status")}),(0,t.jsx)(x.Badge,{variant:"outline",className:(0,i.cn)("capitalize",U[ea.status]),children:ea.status.replace("_"," ")})]})]}),ea.pricingStatus&&(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4 p-3 rounded border border-white/10 bg-white/5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Pricing Status")}),(0,t.jsx)("p",{className:"font-semibold",children:ea.pricingStatus})]}),ea.proposedPrice&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Proposed Price")}),(0,t.jsxs)("p",{className:"font-semibold",children:["AED ",ea.proposedPrice]})]}),ea.proposedPriceMin&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Proposed Range")}),(0,t.jsxs)("p",{className:"font-semibold",children:["AED ",ea.proposedPriceMin," - ",ea.proposedPriceMax]})]}),ea.proposedBreakdown&&(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Breakdown")}),(0,t.jsxs)("div",{className:"text-white/80 text-sm",children:[W("Labor"),": ",ea.proposedBreakdown.labor||0," â€¢ ",W("Parts"),": ",ea.proposedBreakdown.parts||0," â€¢ ",W("Inspection"),": ",ea.proposedBreakdown.inspection||0]})]}),ea.proposalMediaUrls?.length>0&&(0,t.jsx)("div",{className:"col-span-2 grid grid-cols-3 gap-2",children:(ea.proposalMediaUrls||[]).map((e,s)=>(0,t.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",className:"block aspect-square rounded border border-white/10 overflow-hidden",children:(0,t.jsx)("img",{src:e,alt:"media",className:"w-full h-full object-cover"})},s))}),ea.proposedDurationMinutes&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Proposed Duration")}),(0,t.jsxs)("p",{className:"font-semibold",children:[ea.proposedDurationMinutes," ",W("minutes")]})]}),ea.proposedExpiresAt&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Proposal Expires")}),(0,t.jsx)("p",{className:"font-semibold",children:(e=ea.proposedExpiresAt,(j=e?.toDate?.()?e.toDate():"string"==typeof e?new Date(e):null)?j.toLocaleString():W("N/A"))})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Approval Tier")}),(0,t.jsx)("p",{className:"font-semibold",children:null==(L=ea?.proposedBreakdown?Number(ea.proposedBreakdown.labor||0)+Number(ea.proposedBreakdown.parts||0)+Number(ea.proposedBreakdown.inspection||0):ea?.proposedPriceMax??ea?.proposedPriceMin??ea?.proposedPrice??null)?W("Unknown"):L<200?W("Auto-approve recommended (<200 AED)"):L<=500?W("Admin review (200â€“500 AED)"):W("Super Admin review (>500 AED)")})]}),ea.proposalNote&&(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("Technician Note")}),(0,t.jsx)("p",{className:"text-white/80",children:ea.proposalNote})]}),"proposed"===ea.pricingStatus&&"super_admin"===eM&&(0,t.jsxs)("div",{className:"col-span-2 flex gap-2",children:[(0,t.jsx)(h.Button,{onClick:()=>e7(ea),className:"bg-green-600 text-white",children:W("Approve Proposal")}),(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>e9(ea),children:W("Reject Proposal")}),(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>eO(!0),children:W("Counter Offer")})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-1",children:W("ETA (minutes)")}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.Input,{type:"number",value:ed,onChange:e=>ec(e.target.value),className:"bg-white/5 border-white/10 text-white"}),(0,t.jsx)(h.Button,{onClick:e4,className:"bg-cyan-500 hover:bg-cyan-400 text-black",children:W("Save")})]})]}),(0,t.jsx)("div",{children:ea.estimatedCompletion&&(0,t.jsxs)("div",{className:"p-3 rounded border flex items-center gap-3 transition-colors border-white/10 bg-white/5",children:[(0,t.jsx)(b.Clock,{className:"w-5 h-5 text-cyan-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-white/60",children:W("Remaining Time")}),(0,t.jsx)("p",{className:"text-sm font-mono text-white",children:new Date(ea.estimatedCompletion).toLocaleString()})]})]})})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-4",children:W("Order Timeline")}),(0,t.jsxs)("div",{className:"space-y-0 relative",children:[(0,t.jsx)("div",{className:"absolute left-2.5 top-2 bottom-4 w-0.5 bg-zinc-800"}),(H=[{id:"pending",label:W("Order Placed"),description:W("Order has been created")},{id:"in_progress",label:W("In Repair"),description:W("Technician is working on the device")},{id:"completed",label:W("Repair Completed"),description:W("Device is fixed and ready")},{id:"delivered",label:W("Delivered"),description:W("Device returned to customer")}],q=0,(q="delivered"===ea.status?3:"completed"===ea.status?2:+("in_progress"===ea.status||"waiting_parts"===ea.status),"cancelled"===ea.status)?(0,t.jsxs)("div",{className:"relative flex gap-4 pb-6",children:[(0,t.jsx)("div",{className:"relative z-10 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 ring-4 ring-zinc-950",children:(0,t.jsx)(y.AlertTriangle,{className:"h-3 w-3 text-white"})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-red-500",children:W("Order Cancelled")}),(0,t.jsx)("p",{className:"text-xs text-white/50",children:W("This order has been cancelled.")})]})]}):H.map((e,s)=>{let a=s<q,r=s===q,n=s>q,l=ea.statusHistory?.find(t=>"pending"===e.id?"pending"===t.status:"in_progress"===e.id?"in_progress"===t.status||"waiting_parts"===t.status:"completed"===e.id?"completed"===t.status:"delivered"===e.id&&"delivered"===t.status);return(0,t.jsxs)("div",{className:(0,i.cn)("relative flex gap-4 pb-8 last:pb-0",n&&"opacity-40"),children:[(0,t.jsx)("div",{className:(0,i.cn)("relative z-10 flex h-6 w-6 items-center justify-center rounded-full ring-4 ring-zinc-950 transition-colors",a?"bg-cyan-500 text-black":r?"bg-cyan-500 ring-cyan-500/20 animate-pulse text-black":"bg-zinc-800 text-white/30"),children:a?(0,t.jsx)(f.CheckCircle,{className:"h-3 w-3"}):r?(0,t.jsx)(b.Clock,{className:"h-3 w-3"}):(0,t.jsx)("div",{className:"h-2 w-2 rounded-full bg-current"})}),(0,t.jsxs)("div",{className:"flex flex-col -mt-1",children:[(0,t.jsx)("p",{className:(0,i.cn)("text-sm font-medium",r?"text-cyan-400":"text-white"),children:e.label}),(0,t.jsx)("p",{className:"text-xs text-white/50",children:e.description}),(a||r)&&l?.timestamp&&(0,t.jsx)("p",{className:"text-[10px] text-white/30 mt-1",children:new Date(1e3*l.timestamp.seconds).toLocaleString()})]})]},e.id)}))]}),ea.statusHistory&&ea.statusHistory.length>0&&(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t border-white/5",children:[(0,t.jsx)("h5",{className:"text-xs font-medium text-white/40 mb-3 uppercase tracking-wider",children:W("Detailed History")}),(0,t.jsx)("div",{className:"space-y-3 pl-2 border-l border-white/5",children:ea.statusHistory.slice().reverse().map((e,s)=>(0,t.jsxs)("div",{className:"pl-4 relative",children:[(0,t.jsx)("div",{className:"absolute left-[-5px] top-1.5 h-2 w-2 rounded-full bg-white/10"}),(0,t.jsx)("p",{className:"text-xs text-white/70",children:e.note||e.status}),(0,t.jsx)("p",{className:"text-[10px] text-white/30",children:e.timestamp?.seconds?new Date(1e3*e.timestamp.seconds).toLocaleString():W("Just now")})]},s))})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-white/50 mb-4",children:W("Invoice")}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(h.Button,{onClick:eG,className:"bg-cyan-500 text-black",disabled:eP||ea.invoice?.status==="finalized",children:W("Generate Final Invoice")}),(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>em(!0),children:W("Preview Invoice")})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>window.print(),children:W("Print Invoice")}),(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>window.print(),children:W("Download as PDF")})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>{let e=ea?.invoice?.total||ea?.totalCost||ea.price||0,t=`Your repair is completed. Final amount: AED ${e}. Please find your invoice attached. Thank you for choosing KBI.`,s=`ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† ØµÙŠØ§Ù†Ø© Ø¬Ù‡Ø§Ø²Ùƒ. Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${e} Ø¯Ø±Ù‡Ù…. ØªØ¬Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø±Ùƒ KBI.`,i=`${t}

${s}`;ea.customerPhone?(S(ea.customerPhone,i),(0,$.toast)({title:W("WhatsApp opened"),description:W("Invoice sent to customer")})):(0,$.toast)({title:W("No phone number available"),description:W("Add customer phone to order")})},children:W("Resend to Customer")})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(o.Input,{placeholder:W("Discount"),value:ej,onChange:e=>eg(e.target.value),className:"bg-white/5 border-white/10 text-white",disabled:eP||ea.invoice?.status==="finalized"}),(0,t.jsx)(o.Input,{placeholder:W("Warranty Period"),value:ef,onChange:e=>ey(e.target.value),className:"bg-white/5 border-white/10 text-white",disabled:eP||ea.invoice?.status==="finalized"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:ev,onChange:e=>eb(e.target.checked),disabled:eP||ea.invoice?.status==="finalized"}),(0,t.jsx)("span",{className:"text-sm text-white",children:W("VAT Enabled")})]}),(0,t.jsx)(o.Input,{placeholder:W("VAT Rate"),value:eN,onChange:e=>ew(e.target.value),className:"bg-white/5 border-white/10 text-white",disabled:eP||ea.invoice?.status==="finalized"})]}),(0,t.jsx)(o.Input,{placeholder:W("Disclaimer"),value:eI,onChange:e=>eS(e.target.value),className:"bg-white/5 border-white/10 text-white",disabled:eP||ea.invoice?.status==="finalized"}),(0,t.jsx)(o.Input,{placeholder:W("Admin Notes"),value:eD,onChange:e=>eC(e.target.value),className:"bg-white/5 border-white/10 text-white",disabled:eP||ea.invoice?.status==="finalized"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,t.jsx)(h.Button,{variant:"en"===ep?"default":"outline",onClick:()=>eu("en"),disabled:eP||ea.invoice?.status==="finalized",children:W("English")}),(0,t.jsx)(h.Button,{variant:"ar"===ep?"default":"outline",onClick:()=>eu("ar"),disabled:eP||ea.invoice?.status==="finalized",children:W("Arabic")}),(0,t.jsx)(h.Button,{variant:"both"===ep?"default":"outline",onClick:()=>eu("both"),disabled:eP||ea.invoice?.status==="finalized",children:W("EN + AR")})]})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center gap-2",children:[(0,t.jsxs)(x.Badge,{variant:"outline",className:"text-white/70",children:[W("Invoice Status"),": ",ea.invoice?.status||(eP?"finalized":"draft")]}),(0,t.jsx)(h.Button,{onClick:eY,className:"bg-green-600 text-white",disabled:eP||ea.invoice?.status==="finalized",children:W("Finalize Invoice")}),(0,t.jsx)(o.Input,{placeholder:W("Override reason"),value:eA,onChange:e=>eT(e.target.value),className:"bg-white/5 border-white/10 text-white max-w-xs"}),(0,t.jsx)(h.Button,{variant:"outline",onClick:eZ,children:W("Override Edit")})]})]})]})]})]})}),(0,t.jsx)(p.Dialog,{open:eo,onOpenChange:em,children:(0,t.jsxs)(p.DialogContent,{className:"bg-white text-black sm:max-w-[800px]",children:[(0,t.jsx)(p.DialogHeader,{children:(0,t.jsx)(p.DialogTitle,{children:W("Invoice Preview")})}),ea&&(0,t.jsx)("div",{className:"max-h-[70vh] overflow-auto",children:(0,t.jsx)(E,{order:ea,items:eJ(ea),invoiceNumber:eh,invoiceDate:new Date().toISOString(),language:ep,discount:Number(ej||0),vatEnabled:ev,vatRate:Number(eN||0),warrantyPeriod:ef,adminNotes:eD,disclaimerText:eI})}),(0,t.jsxs)(p.DialogFooter,{children:[(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>window.print(),children:W("Print Invoice")}),(0,t.jsx)(h.Button,{onClick:eY,children:W("Finalize Invoice")})]})]})}),(0,t.jsx)(p.Dialog,{open:ez,onOpenChange:eO,children:(0,t.jsxs)(p.DialogContent,{className:"bg-zinc-900 border-zinc-800 text-white sm:max-w-[500px]",children:[(0,t.jsx)(p.DialogHeader,{children:(0,t.jsxs)(p.DialogTitle,{children:[W("Counter Offer"),": ",ea?.orderId]})}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(o.Input,{type:"number",placeholder:W("Counter Price (AED)"),value:e_,onChange:e=>eE(e.target.value),className:"bg-white/5 border-white/10 text-white"}),(0,t.jsx)(o.Input,{type:"number",placeholder:W("Counter Duration (minutes)"),value:e$,onChange:e=>eR(e.target.value),className:"bg-white/5 border-white/10 text-white"}),(0,t.jsx)(o.Input,{type:"text",placeholder:W("Arrival ETA"),value:eF,onChange:e=>eU(e.target.value),className:"bg-white/5 border-white/10 text-white"}),(0,t.jsx)(o.Input,{type:"text",placeholder:W("Note"),value:eL,onChange:e=>eH(e.target.value),className:"bg-white/5 border-white/10 text-white"})]}),(0,t.jsx)(p.DialogFooter,{children:(0,t.jsx)(h.Button,{onClick:()=>ea&&te(ea),children:W("Save Counter")})})]})})]})}e.s(["default",()=>L],63116)}]);