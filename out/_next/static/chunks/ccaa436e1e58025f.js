(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let r=(0,e.i(75254).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>r],55436)},94983,e=>{"use strict";let r=(0,e.i(75254).default)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);e.s(["MessageCircle",()=>r],94983)},3116,e=>{"use strict";let r=(0,e.i(75254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>r],3116)},84614,e=>{"use strict";let r=(0,e.i(75254).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>r],84614)},69638,6321,e=>{"use strict";let r=(0,e.i(75254).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["default",()=>r],6321),e.s(["CheckCircle",()=>r],69638)},78894,e=>{"use strict";let r=(0,e.i(75254).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>r],78894)},86536,90489,75059,e=>{"use strict";let r=(0,e.i(75254).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>r],86536),e.i(51718);var t=e.i(18357);e.i(36180);var o=e.i(98925),a=e.i(11605);async function i(e,r,t,i,n){try{await (0,o.addDoc)((0,o.collection)(a.db,"audit_logs"),{action:e,category:r,userId:t,userEmail:i,targetId:n?.targetId||null,targetType:n?.targetType||null,details:n?.details||null,timestamp:o.Timestamp.now()})}catch(e){console.error("Failed to log audit action:",e)}}let n={ORDER_CREATED:"order_created",ORDER_UPDATED:"order_updated",ORDER_DELETED:"order_deleted",ORDER_ASSIGNED:"order_assigned",ORDER_STATUS_CHANGED:"order_status_changed",TECHNICIAN_CREATED:"technician_created",TECHNICIAN_UPDATED:"technician_updated",TECHNICIAN_DELETED:"technician_deleted",INVENTORY_ADDED:"inventory_added",INVENTORY_UPDATED:"inventory_updated",INVENTORY_DELETED:"inventory_deleted",USER_LOGIN:"user_login",USER_LOGOUT:"user_logout",PASSWORD_CHANGED:"password_changed",REQUEST_PASSWORD_RESET:"request_password_reset",OTP_SENT:"otp_sent",OTP_VERIFIED:"otp_verified",PASSWORD_RESET_SUCCESS:"password_reset_success",PASSWORD_RESET_FAILED:"password_reset_failed",SETTINGS_UPDATED:"settings_updated",EXPORT_GENERATED:"export_generated",EMAIL_SENT:"email_sent"};async function s(){try{await (0,t.signOut)(a.auth)}catch(e){throw console.error("Sign out error:",e),Error(e.message||"Failed to sign out")}}async function d(e){try{let r=await (0,o.getDoc)((0,o.doc)(a.db,"users",e));if(!r.exists())return null;return{uid:r.id,...r.data()}}catch(e){return console.error("Get user data error:",e),null}}async function c(e){let r=await d(e);return r?.role||null}async function p(e,r){let o=a.auth.currentUser;if(!o||!o.email)throw Error("Not authenticated");let s=t.EmailAuthProvider.credential(o.email,e);await (0,t.reauthenticateWithCredential)(o,s),await (0,t.updatePassword)(o,r),await i(n.PASSWORD_CHANGED,"auth",o.uid,o.email||"")}e.s(["AuditActions",0,n,"logAction",()=>i],90489),e.s(["changePassword",()=>p,"getUserRole",()=>c,"signOut",()=>s],75059)},25324,e=>{"use strict";e.i(36180);var r=e.i(98925),t=e.i(11605);async function o(e){return(await (0,r.addDoc)((0,r.collection)(t.db,"notifications"),{...e,read:!1,createdAt:r.Timestamp.now()})).id}async function a(e,o){try{await (0,r.updateDoc)((0,r.doc)(t.db,"orders",e),{...o,updatedAt:(0,r.serverTimestamp)()})}catch(e){throw console.error("Update order error:",e),Error(e.message||"Failed to update order")}}async function i(e,t){let i=t.proposedBreakdown?Number(t.proposedBreakdown.labor||0)+Number(t.proposedBreakdown.parts||0)+Number(t.proposedBreakdown.inspection||0):null,n=t.proposedPriceMax??t.proposedPriceMin??null,s=i??n??null,d=r.Timestamp.fromDate(new Date(Date.now()+1728e5)),c={proposedPrice:t.proposedPriceMax??t.proposedPriceMin??null,proposedPriceMin:t.proposedPriceMin??null,proposedPriceMax:t.proposedPriceMax??null,proposedBreakdown:t.proposedBreakdown??null,proposedDurationMinutes:t.proposedDurationMinutes,proposedArrivalETA:t.proposedArrivalETA??null,proposalNote:t.proposalNote||null,proposalMediaUrls:t.proposalMediaUrls||null,proposedByTechnicianId:t.proposedByTechnicianId,proposedAt:(0,r.serverTimestamp)(),proposedExpiresAt:d,pricingStatus:"proposed"};await a(e,c);try{let r=`Technician proposed pricing for order ${e}`+(null!=s?` • AED ${s}`:"");await o({type:"system",title:"Pricing Proposed",message:r,role:"admin",orderId:e,link:"/admin/orders"}),null!=s&&s>500?await o({type:"system",title:"High-Value Proposal",message:`Order ${e} requires Super Admin review • AED ${s}`,role:"super_admin",orderId:e,link:"/admin/orders"}):null!=s&&s<200&&await o({type:"system",title:"Auto-Approval Candidate",message:`Order ${e} proposed under AED 200 • Consider auto-approve`,role:"admin",orderId:e,link:"/admin/orders"})}catch(e){}}async function n(e,i){let n=await (0,r.getDoc)((0,r.doc)(t.db,"orders",e));if(!n.exists())return;let s=n.data(),d={approvedPrice:s.proposedBreakdown?Number(s.proposedBreakdown.labor||0)+Number(s.proposedBreakdown.parts||0)+Number(s.proposedBreakdown.inspection||0):s.proposedPriceMax??s.proposedPrice??null,approvedDurationMinutes:s.proposedDurationMinutes??null,approvedArrivalETA:s.proposedArrivalETA??null,approvedByAdminId:i,approvedAt:(0,r.serverTimestamp)(),pricingStatus:"approved"};await a(e,d);try{await o({type:"system",title:"Pricing Approved",message:`Pricing approved for order ${e}`,role:"technician",orderId:e,link:"/technician/orders"})}catch(e){}}async function s(e){await a(e,{pricingStatus:"rejected"});try{await o({type:"system",title:"Pricing Rejected",message:`Pricing rejected for order ${e}`,role:"technician",orderId:e,link:"/technician/orders"})}catch(e){}}async function d(e,t,i){let n={counterPrice:i.counterPrice??null,counterDurationMinutes:i.counterDurationMinutes??null,counterArrivalETA:i.counterArrivalETA??null,approvedByAdminId:t,counterByAdminId:t,counterAt:(0,r.serverTimestamp)(),pricingStatus:"countered",proposalNote:i.counterNote??null};await a(e,n);try{await o({type:"system",title:"Counter Offer",message:`Counter offer posted for order ${e}`,role:"technician",orderId:e,link:"/technician/orders"})}catch(e){}}async function c(e,o){let i=(0,r.doc)(t.db,"orders",e),n=await (0,r.getDoc)(i);if(!n.exists())throw Error("Order not found");let s=n.data();if("assigned"!==s.status||s.technicianId&&s.technicianId!==o)throw Error("Not allowed to accept");await a(e,{status:"accepted"})}async function p(e,i){let n=(0,r.doc)(t.db,"orders",e),s=await (0,r.getDoc)(n);if(!s.exists())throw Error("Order not found");let d=s.data();if("countered"!==d.pricingStatus||d.technicianId&&d.technicianId!==i)throw Error("Not allowed to re-accept");await a(e,{pricingStatus:"re_accepted"});try{await o({type:"system",title:"Counter Offer Accepted",message:`Technician accepted counter offer for order ${e}`,role:"admin",orderId:e,link:"/admin/orders"})}catch(e){}}async function l(e,o){let i=(0,r.doc)(t.db,"orders",e),n=await (0,r.getDoc)(i);if(!n.exists())throw Error("Order not found");let s=n.data();if("approved"!==s.pricingStatus||s.technicianId&&s.technicianId!==o)throw Error("Cannot start work");await a(e,{status:"in_progress"})}e.s(["acceptAssignedOrder",()=>c,"approveOrderPricing",()=>n,"counterOfferPricing",()=>d,"proposeOrderPricing",()=>i,"reAcceptCounterOffer",()=>p,"rejectOrderPricing",()=>s,"startWork",()=>l],25324)}]);