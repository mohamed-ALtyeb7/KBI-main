(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),a=e.i(75157);function i({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...i})}function r({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...i})}function n({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...i})}function s({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...i})}e.s(["Card",()=>i,"CardContent",()=>s,"CardHeader",()=>r,"CardTitle",()=>n])},24687,e=>{"use strict";var t=e.i(43476),a=e.i(75157);function i({className:e,...i}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,a.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...i})}e.s(["Textarea",()=>i])},99048,e=>{"use strict";var t=e.i(43476),a=e.i(71645);e.i(36180);var i=e.i(98925),r=e.i(11605);e.i(51718);var n=e.i(18357),s=e.i(83814),d=e.i(15288),c=e.i(19455),o=e.i(93479),l=e.i(24687),u=e.i(87486),m=e.i(75157),p=e.i(22016);function h(){let e=(0,s.useT)(),[h,x]=(0,a.useState)(!1),[g,w]=(0,a.useState)([]),[b,v]=(0,a.useState)(null),[f,j]=(0,a.useState)(""),[y,N]=(0,a.useState)({});(0,a.useEffect)(()=>{if(r.isMockMode){if(!window.localStorage.getItem("mock_admin_user"))return void window.location.replace("/admin/login");x(!0)}else{let e=(0,n.onAuthStateChanged)(r.auth,e=>{e?x(!0):window.location.replace("/admin/login")});return()=>e()}},[]),(0,a.useEffect)(()=>{if(r.isMockMode)return void w([{id:"req-1",orderId:"ORD-1024",technicianId:"tech-1",technicianName:"Ahmed",partOrServiceName:"iPhone Screen Replacement",category:"spare_part",quantity:1,estimatedPrice:350,reason:"Original screen cracked during diagnosis",photoUrl:"",status:"pending",createdAt:new Date().toISOString()},{id:"req-2",orderId:"ORD-1025",technicianId:"tech-2",technicianName:"Sara",partOrServiceName:"Data Backup Service",category:"additional_service",quantity:1,estimatedPrice:120,reason:"Customer requested full backup before repair",photoUrl:"",status:"approved",createdAt:new Date().toISOString(),finalPrice:100}]);let e=(0,i.query)((0,i.collection)(r.db,"tech_requests"),(0,i.orderBy)("createdAt","desc")),t=(0,i.onSnapshot)(e,e=>{w(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>t()},[]);let C=async e=>{if(r.isMockMode)return;let t=(0,i.doc)(r.db,"orders",e.orderId),a=(e.finalPrice??e.estimatedPrice)*e.quantity;await (0,i.updateDoc)(t,{invoiceItems:(0,i.arrayUnion)({description:e.partOrServiceName,category:e.category,quantity:e.quantity,unitPrice:e.finalPrice??e.estimatedPrice,total:a,requestId:e.id,addedAt:i.Timestamp.now()}),totalCost:e.totalCost?e.totalCost+a:void 0,pendingRequestsCount:e.pendingRequestsCount?e.pendingRequestsCount-1:void 0,updatedAt:i.Timestamp.now(),status:"in_progress"})},S=async(e,t,a)=>{r.isMockMode||await (0,i.addDoc)((0,i.collection)(r.db,"notifications"),{role:e,userId:"technician"===e?a.technicianId:void 0,type:"tech_request",message:t,orderId:a.orderId,requestId:a.id,createdAt:i.Timestamp.now()})},q=async t=>{if(r.isMockMode)return void w(e=>e.map(e=>e.id===t.id?{...e,status:"approved",updatedAt:new Date().toISOString(),adminNotes:y[t.id]||e.adminNotes}:e));let a=(0,i.doc)(r.db,"tech_requests",t.id);await (0,i.updateDoc)(a,{status:"approved",updatedAt:i.Timestamp.now(),adminNotes:y[t.id]||null,history:(0,i.arrayUnion)({action:"approved",by:"admin",at:i.Timestamp.now(),note:y[t.id]||null})}),await C(t),await S("technician",e("Request approved"),t)},A=async t=>{if(r.isMockMode)return void w(e=>e.map(e=>e.id===t.id?{...e,status:"rejected",updatedAt:new Date().toISOString(),adminNotes:y[t.id]||e.adminNotes}:e));let a=(0,i.doc)(r.db,"tech_requests",t.id);await (0,i.updateDoc)(a,{status:"rejected",updatedAt:i.Timestamp.now(),adminNotes:y[t.id]||null,history:(0,i.arrayUnion)({action:"rejected",by:"admin",at:i.Timestamp.now(),note:y[t.id]||null})}),await S("technician",e("Request rejected"),t)},P=async t=>{let a=parseFloat(f);if(isNaN(a)||a<0)return;if(r.isMockMode){w(e=>e.map(e=>e.id===t.id?{...e,finalPrice:a,updatedAt:new Date().toISOString(),priceChanges:[...e.priceChanges||[],{oldPrice:e.estimatedPrice,newPrice:a,changedAt:new Date().toISOString(),changedBy:"admin"}]}:e)),v(null),j("");return}let n=(0,i.doc)(r.db,"tech_requests",t.id);await (0,i.updateDoc)(n,{finalPrice:a,updatedAt:i.Timestamp.now(),priceChanges:(0,i.arrayUnion)({oldPrice:t.estimatedPrice,newPrice:a,changedAt:i.Timestamp.now(),changedBy:"admin"}),history:(0,i.arrayUnion)({action:"price_updated",by:"admin",at:i.Timestamp.now(),note:`AED ${t.estimatedPrice} -> AED ${a}`})}),v(null),j(""),await S("technician",e("Price updated by admin"),t)};return h?(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h1",{className:"text-2xl font-bold text-white",children:e("Technician Requests")})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[g.map(a=>{let i;return(0,t.jsxs)(d.Card,{className:"bg-white/5 border-white/10",children:[(0,t.jsx)(d.CardHeader,{children:(0,t.jsxs)(d.CardTitle,{className:"text-white flex items-center justify-between",children:[(0,t.jsx)("span",{children:a.partOrServiceName}),(i=a.status,(0,t.jsx)(u.Badge,{variant:"outline",className:(0,m.cn)("capitalize","pending"===i?"text-yellow-400 border-yellow-400/40":"approved"===i?"text-green-400 border-green-400/40":"text-red-400 border-red-400/40"),children:e(i.charAt(0).toUpperCase()+i.slice(1))}))]})}),(0,t.jsxs)(d.CardContent,{className:"space-y-3 text-sm text-white/80",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{children:["#",a.orderId]}),(0,t.jsx)(p.default,{href:"/admin/orders",className:"text-cyan-400 hover:underline",children:e("View Details")})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{children:[e("Quantity"),": ",a.quantity]}),(0,t.jsxs)("span",{children:[e("Estimated Price (AED)"),": ",a.estimatedPrice]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-white/50",children:[e("Reason for Request"),":"]}),(0,t.jsx)("p",{className:"mt-1",children:a.reason})]}),a.photoUrl&&(0,t.jsx)("img",{src:a.photoUrl,alt:"photo",className:"w-full h-36 object-cover rounded-lg border border-white/10"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-white/50",children:e("Admin Notes")}),(0,t.jsx)(l.Textarea,{value:y[a.id]||"",onChange:e=>{let t,i;return t=a.id,i=e.target.value,N(e=>({...e,[t]:i}))},className:"bg-black/20 border-white/10 text-white"})]}),(0,t.jsx)("div",{className:"space-y-2",children:b===a.id?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.Input,{type:"number",value:f,onChange:e=>j(e.target.value),className:"bg-black/20 border-white/10 text-white"}),(0,t.jsx)(c.Button,{onClick:()=>P(a),className:"bg-cyan-500 text-black",children:e("Save")}),(0,t.jsx)(c.Button,{variant:"outline",onClick:()=>{v(null),j("")},children:e("Cancel")})]}):(0,t.jsx)(c.Button,{variant:"outline",onClick:()=>{v(a.id),j(String(a.finalPrice??a.estimatedPrice))},children:e("Edit Price")})}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsx)(c.Button,{onClick:()=>q(a),className:"bg-green-500 text-black",children:e("Approve Request")}),(0,t.jsx)(c.Button,{onClick:()=>A(a),className:"bg-red-500 text-white",children:e("Reject Request")})]})]})]},a.id)}),0===g.length&&(0,t.jsx)(d.Card,{className:"bg-white/5 border-white/10",children:(0,t.jsx)(d.CardContent,{className:"p-6 text-white/60",children:e("No requests")})})]})]}):null}e.s(["default",()=>h])}]);